services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    environment:
      - SPRING_AUTO_CONFIGURE_EXCLUDE=org.springframework.boot.autoconfigure.security.saml2.Saml2RelyingPartyAutoConfiguration
      - SAML_ENABLED=${SAML_ENABLED:-false}
      - SAML_IDP_METADATA_URI=${SAML_IDP_METADATA_URI:-classpath:saml/idp-placeholder.xml}
      - SAML_ENTITY_ID=${SAML_ENTITY_ID:-http://localhost:8080/saml2/service-provider-metadata/entra}
      - APP_FRONTEND_BASE_URL=${APP_FRONTEND_BASE_URL:-http://localhost:3000}
    ports:
      - "8080:8080"
    networks:
      - saml-net

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    environment:
      - NODE_ENV=development
      - NEXT_PUBLIC_API_BASE_URL=http://localhost:8080
      - NEXT_DEV_HTTPS_KEY=${NEXT_DEV_HTTPS_KEY:-./certs/localhost-key.pem}
      - NEXT_DEV_HTTPS_CERT=${NEXT_DEV_HTTPS_CERT:-./certs/localhost-cert.pem}
      - DEV_HOST=0.0.0.0
      - DEV_PORT=3000
    ports:
      - "3000:3000"
    command: npm run dev
    depends_on:
      - backend
    networks:
      - saml-net

networks:
  saml-net: {}
